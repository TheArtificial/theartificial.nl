var $placeholderCard = $("<%=escape_javascript( mustache_template('templates/_placeholder_card.html') ) %>"); // displaying // returns a jQuery element for a given lunr.js-style document object function renderCard(doc) { var type = doc.type; template = "<%=escape_javascript( mustache_template('templates/_unknown_card.mustache') ) %>";

function renderCard(doc) {
  var type = doc.type;
  var view = {
    url: doc.url,
    title: doc.title
  };
  var post_date = new Date(doc.date);
  var formatted_date = monthName(post_date.getMonth()) + ' ' + post_date.getDate() + ', ' + post_date.getFullYear();
  view.date = formatted_date;
  if (type == 'blog') {
    view.author = doc.author;
    view.category = doc.category;
    view.summary = doc.summary;
    template = "<%=escape_javascript( mustache_template('templates/_card_blog.mustache') ) %>";
  } else if (type == 'blog_image') {
    view.author = doc.author;
    view.image_url = doc.image_url;
    view.category = doc.category;
    template = "<%=escape_javascript( mustache_template('templates/_card_blog_image.mustache') ) %>";
  } else if (type == 'cocktail') {
    view.author = doc.author;
    view.glass = doc.glass;
    view.contents = doc.contents;
    template = "<%=escape_javascript( mustache_template('templates/_cocktail_card.mustache') ) %>";
  } else if (type == 'work') {
    view.color = doc.color;
    view.thumbnail = doc.thumbnail;
    template = "<%=escape_javascript( mustache_template('templates/_work_card.mustache') ) %>";
  } else if (type == 'ftfy') {
    view.author = doc.author;
    view.image = doc.image;
    template = "<%=escape_javascript( mustache_template('templates/_ftfy_card.mustache') ) %>";
  } else {
    template = "<%=escape_javascript( mustache_template('templates/_unknown_card.mustache') ) %>";
  }
  return $(Mustache.render(template, view));
}

// add a card to a container
function addCard($container, doc) {
  var $newCard = $placeholderCard.clone();
  var $newCard = renderCard(doc);

  $container.append($newCard)
    // add and layout newly appended items
    .packery('appended', $newCard)
    .packery('layout');
  // re-layout on image load
  $newCard.imagesLoaded().done( function( instance, image ) {
    console.log("Image loaded", instance)
    $container.packery('layout');
  });
  $container.packery();
  console.log("Started card", doc.url);

  // render card async
  setTimeout(function(){
    console.log("Rendered card", doc.url);
    $newCard = renderCard(doc);
  }, 1);
}

var monthNames = new Array("January","February","March","April","May"," June","July","August","September","October","November","December");
function monthName(n) {
  return(monthNames[n]);
}
