<% wrap_layout :project_layout do %>
<script src="../js/lottie.js"> </script>

<div class="bleed walkthrough">
  <div class="flex container">
    <div class="col-4 thing-space">
      <div class="padded">
        <img id="thing" src="">
      </div>
    </div>
    <div class="col-4 flow-space">
      <div class="padded">
        <div id="network" style="position: relative;"></div>
      </div>
    </div>
    <div class="col-4 screen-space">
      <div class="padded">
        <img id="screen" src="">
      </div>
    </div>
  </div>
</div>

<div class="bleed cool-grey-80">
  <div class="flex container walkthrough-controls">
    <div class="col-2">
      <div class="padded">
        <a href="#" id="prev-button">
          <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          	 width="20px" height="20px" viewBox="0 0 20 20" style="enable-background:new 0 0 20 20;" xml:space="preserve">
          <path class="arrow" d="M17,9H4.414l6.293-6.293c0.391-0.391,0.391-1.023,0-1.414s-1.023-0.391-1.414,0l-8,8c0,0,0,0-0.001,0.001
          	L0.586,10l0.707,0.707c0,0,0,0,0.001,0.001l8,8C9.488,18.902,9.744,19,10,19s0.512-0.098,0.707-0.293
          	c0.391-0.391,0.391-1.023,0-1.414L4.414,11H17c0.552,0,1-0.448,1-1S17.552,9,17,9z"/>
          </svg>
          <p>previous</p>
        </a>
      </div>
    </div>
    <div class="col-8">
      <div class="padded">
        <p class="current-step" id="caption"><span class="counter"></span> <span class="step-description"></span></p>
      </div>
    </div>
    <div class="col-2">
      <div class="padded">
        <a href="#" id="next-button">
          <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
             width="20px" height="20px" viewBox="0 0 20 20" style="enable-background:new 0 0 20 20;" xml:space="preserve">
          <path class="arrow" d="M18.708,10.706L19.414,10l-0.706-0.706c-0.001-0.001-0.001-0.001-0.002-0.002l-7.999-7.999
            c-0.391-0.391-1.023-0.391-1.414,0s-0.391,1.023,0,1.414L15.586,9H3c-0.553,0-1,0.448-1,1s0.447,1,1,1h12.586l-6.293,6.293
            c-0.391,0.391-0.391,1.023,0,1.414C9.488,18.902,9.744,19,10,19s0.512-0.098,0.707-0.293l7.999-7.999
            C18.707,10.707,18.707,10.707,18.708,10.706z"/>
          </svg>
          <p>next</p>
        </a>
      </div>
    </div>
  </div>
</div>

<div class="bleed cool-grey-10">
  <div class="flex container extra-bottom">
    <div class="col-12">
      <div class="padded">
        <h1 class="title"><%= current_page.data.title %></h1>
<!--
        What is this? The total number (also seen in the caption) or UI steps or connection states, orâ€¦?
        <h3 class="step-count">6 Steps</h3>
 -->
      </div>
    </div>

    <div class="col-10 right-1 left-1">
      <div class="padded">

        <%= yield %>

      </div>
    </div>
  </div>
</div>

<script>

// some variables so we don't waste cycles looking for elements over and over
var $thing = $('#thing');
var $network = $('#network');
var $screen = $('#screen');
var $counter = $('#caption .counter');
var $caption = $('#caption .step-description');
// variable that will increment through the steps
var currentStep = 0;


var totalSteps = flowSteps.length;

function setAnimationLayers(layers) {
  if (typeof layers !== 'undefined' && layers.length > 0) {
    $network.empty(); // clear previous layers

    for (var i = 0; i < layers.length; i++) {
      var filename = layers[i];
      var $layer = $('<div></div>');
      $layer.css({
        position: 'absolute',
        top: '0'
      });
      var layerElement = $layer.get(0);
      lottie.loadAnimation({
        container: layerElement,
        renderer: 'svg',
        loop: true,
        autoplay: false,
        path: '../animations/' + filename
      });
      $network.append($layer);
    }

    lottie.play();
  }
};

// make one happen
function renderStep(number) {
  var step = flowSteps[number];
  var caption = step.caption;
  var thingPath = step.thingImg;
  var networkPath = step.networkAnimations;
  var screenPath = step.screenImg;

  // set caption
  $counter.text((currentStep+1)+'/'+totalSteps);
  $caption.text(caption);
  // set thing image

  if (thingPath) {
    $thing.attr('src', thingPath);
  }
  // set and start animation
  if (networkPath) {
    setAnimationLayers(networkPath);
  }
  // set screen image
  if (screenPath) {
    $screen.attr('src', screenPath);
  }

};

$(document).ready(function() {

  $('#prev-button').on('click', function(){
    if (currentStep > 0) {
      currentStep--;
      renderStep(currentStep);
      // TODO: if at last step, disable button
    }
  });
  $('#next-button').on('click', function(){
    if (currentStep < totalSteps-1) {
      currentStep++;
      renderStep(currentStep);
      // TODO: if at last step, disable button
    }
  });

  renderStep(0);
});

</script>

<%= partial '../things_footer' %>

<% end # project_layout %>
